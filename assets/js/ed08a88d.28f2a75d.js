"use strict";(self.webpackChunktemp=self.webpackChunktemp||[]).push([[4300],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>u});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=a.createContext({}),d=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=d(e.components);return a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),c=d(n),u=l,k=c["".concat(p,".").concat(u)]||c[u]||m[u]||r;return n?a.createElement(k,i(i({ref:t},s),{},{components:n})):a.createElement(k,i({ref:t},s))}));function u(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,i=new Array(r);i[0]=c;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:l,i[1]=o;for(var d=2;d<r;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},1007:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(7294),l=n(6010);const r="browserWindow_my1Q",i="browserWindowHeader_jXSR",o="buttons_uHc7",p="browserWindowAddressBar_Pd8y",d="dot_giz1",s="browserWindowMenuIcon_Vhuh",m="bar_rrRL",c="browserWindowBody_Idgs";function u(e){let{children:t,minHeight:n,url:u="http://localhost:3000"}=e;return a.createElement("div",{className:r,style:{minHeight:n}},a.createElement("div",{className:i},a.createElement("div",{className:o},a.createElement("span",{className:d,style:{background:"#f25f58"}}),a.createElement("span",{className:d,style:{background:"#fbbe3c"}}),a.createElement("span",{className:d,style:{background:"#58cb42"}})),a.createElement("div",{className:(0,l.Z)(p,"text--truncate")},u),a.createElement("div",{className:s},a.createElement("div",null,a.createElement("span",{className:m}),a.createElement("span",{className:m}),a.createElement("span",{className:m})))),a.createElement("div",{className:c},t))}},2232:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7294);const l="codeDescription_fg9D",r="codeDescriptionBody_Gp1s";function i(e){let{children:t,minHeight:n}=e;return a.createElement("div",{className:l,style:{minHeight:n}},a.createElement("div",{className:r},t))}},3691:(e,t,n)=>{n.d(t,{L:()=>l,W:()=>r});var a=n(7294);function l(e){let{children:t}=e;return a.createElement("span",{style:{backgroundColor:"#9747FF",borderRadius:"2px",color:"#fff",padding:"0.2rem"}},t)}function r(e){let{children:t}=e;return a.createElement("span",{style:{backgroundColor:"#6A77D7",borderRadius:"2px",color:"#fff",padding:"0.2rem"}},t)}},5345:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7294);const l="PreviewDescription_enzD",r="PreviewDescriptionBody_t2U9";function i(e){let{children:t,minHeight:n}=e;return a.createElement("div",{className:l,style:{minHeight:n}},a.createElement("div",{className:r},t))}},9751:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>d,default:()=>k,frontMatter:()=>p,metadata:()=>s,toc:()=>c});var a=n(7462),l=(n(7294),n(3905)),r=(n(2232),n(5345)),i=n(1007),o=n(3691);const p={sidebar_position:1,description:"\ud83d\udccc Iris \ub370\uc774\ud130\ub97c \uc785\ub825\ubc1b\uc544 \uc608\uce21\uac12\uc744 \ubc18\ud658\ud558\ub294 API \ub97c \uc791\uc131\ud569\ub2c8\ub2e4."},d="1) Model API",s={unversionedId:"api-serving/model-api",id:"api-serving/model-api",title:"1) Model API",description:"\ud83d\udccc Iris \ub370\uc774\ud130\ub97c \uc785\ub825\ubc1b\uc544 \uc608\uce21\uac12\uc744 \ubc18\ud658\ud558\ub294 API \ub97c \uc791\uc131\ud569\ub2c8\ub2e4.",source:"@site/docs/api-serving/model-api.mdx",sourceDirName:"api-serving",slug:"/api-serving/model-api",permalink:"/tutorial/docs/api-serving/model-api",draft:!1,editUrl:"https://github.com/mlops-for-mle/tutorial/tree/main/docs/api-serving/model-api.mdx",tags:[],version:"current",lastUpdatedBy:"Jongseob Jeon",lastUpdatedAt:1706087831,formattedLastUpdatedAt:"Jan 24, 2024",sidebarPosition:1,frontMatter:{sidebar_position:1,description:"\ud83d\udccc Iris \ub370\uc774\ud130\ub97c \uc785\ub825\ubc1b\uc544 \uc608\uce21\uac12\uc744 \ubc18\ud658\ud558\ub294 API \ub97c \uc791\uc131\ud569\ub2c8\ub2e4."},sidebar:"tutorialSidebar",previous:{title:"0) Overview",permalink:"/tutorial/docs/api-serving/overview"},next:{title:"2) Model API on Docker Compose",permalink:"/tutorial/docs/api-serving/model-api-on-docker-compose"}},m={},c=[{value:"Chapter Preview",id:"chapter-preview",level:2},{value:"\ubaa9\ud45c",id:"\ubaa9\ud45c",level:3},{value:"\uc2a4\ud399 \uba85\uc138\uc11c",id:"\uc2a4\ud399-\uba85\uc138\uc11c",level:3},{value:"0. \ud658\uacbd \uc124\uc815",id:"0-\ud658\uacbd-\uc124\uc815",level:2},{value:"1. \ubaa8\ub378 \ub2e4\uc6b4\ub85c\ub4dc",id:"1-\ubaa8\ub378-\ub2e4\uc6b4\ub85c\ub4dc",level:2},{value:"1.1 Base Setting",id:"11-base-setting",level:3},{value:"1.2 Environment Variables",id:"12-environment-variables",level:3},{value:"1.3 \ubaa8\ub378 \ub2e4\uc6b4\ub85c\ub4dc \ud568\uc218 \uc791\uc131",id:"13-\ubaa8\ub378-\ub2e4\uc6b4\ub85c\ub4dc-\ud568\uc218-\uc791\uc131",level:3},{value:"1.4 \ubaa8\ub378 \ub2e4\uc6b4\ub85c\ub4dc",id:"14-\ubaa8\ub378-\ub2e4\uc6b4\ub85c\ub4dc",level:3},{value:"1.5 <code>download_model.py</code>",id:"15-download_modelpy",level:3},{value:"1.6 \uc2a4\ud06c\ub9bd\ud2b8 \uc2e4\ud589",id:"16-\uc2a4\ud06c\ub9bd\ud2b8-\uc2e4\ud589",level:3},{value:"2. Model API \uba85\uc138\uc11c \uc791\uc131",id:"2-model-api-\uba85\uc138\uc11c-\uc791\uc131",level:2},{value:"3. Pydantic Model \ub85c \uc2a4\ud0a4\ub9c8\uc758 \ud074\ub798\uc2a4 \uc791\uc131",id:"3-pydantic-model-\ub85c-\uc2a4\ud0a4\ub9c8\uc758-\ud074\ub798\uc2a4-\uc791\uc131",level:2},{value:"3.1 Import",id:"31-import",level:3},{value:"3.2 Input schema",id:"32-input-schema",level:3},{value:"3.3 Output schema",id:"33-output-schema",level:3},{value:"3.4 <code>schemas.py</code>",id:"34-schemaspy",level:3},{value:"4. Predict API \uad6c\ud604",id:"4-predict-api-\uad6c\ud604",level:2},{value:"4.1 Import",id:"41-import",level:3},{value:"4.2 Load model",id:"42-load-model",level:3},{value:"4.3 Create a FastAPI instance",id:"43-create-a-fastapi-instance",level:3},{value:"4.4 Write <code>predict</code> function",id:"44-write-predict-function",level:3},{value:"4.5 <code>app.py</code>",id:"45-apppy",level:3},{value:"5. API \uc791\ub3d9 \ud655\uc778",id:"5-api-\uc791\ub3d9-\ud655\uc778",level:2}],u={toc:c};function k(e){let{components:t,...p}=e;return(0,l.kt)("wrapper",(0,a.Z)({},u,p,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"1-model-api"},"1) Model API"),(0,l.kt)(r.Z,{mdxType:"PreviewDescription"},(0,l.kt)("h2",{id:"chapter-preview"},"Chapter Preview"),(0,l.kt)("hr",null),(0,l.kt)("h3",{id:"\ubaa9\ud45c"},"\ubaa9\ud45c"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Iris \ub370\uc774\ud130\ub97c \uc785\ub825\ubc1b\uc544 \uc608\uce21\uac12\uc744 \ubc18\ud658\ud558\ub294 API \ub97c \uc791\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"\uc791\uc131\ud55c API \uc5d0 \ub370\uc774\ud130\ub97c \uc804\ub2ec\ud558\uc5ec \uc81c\ub300\ub85c \uc791\ub3d9\ud558\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4.")),(0,l.kt)("h3",{id:"\uc2a4\ud399-\uba85\uc138\uc11c"},"\uc2a4\ud399 \uba85\uc138\uc11c"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)(o.L,{mdxType:"Part"},"03. Model Registry")," \ud30c\ud2b8\uc5d0\uc11c \ubaa8\ub378\uc744 \ud559\uc2b5\ud55c \ud6c4 \uc800\uc7a5\ud55c MLflow \uc11c\ubc84\uc758 Model Registry \uc5d0\uc11c \ubaa8\ub378\uc744 \ub85c\uceec\ub85c \ub2e4\uc6b4\ub85c\ub4dc\ubc1b\ub294 \uc2a4\ud06c\ub9bd\ud2b8 `download_model.py` \ub97c \uc791\uc131\ud558\uace0 \uc2e4\ud589\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"POST /predict")," \ub97c \uc218\ud589\ud558\uba74 \ud559\uc2b5\ud55c \ubaa8\ub378\uc758 inference \uacb0\uacfc\ub97c \ubc18\ud658\ud558\ub294 API \uc758 \uba85\uc138\uc11c\ub97c \uc791\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"schemas.py")," \uc5d0\uc11c Pydantic \uc744 \uc0ac\uc6a9\ud574 input schema \uc640 output schema \uc758 \ud074\ub798\uc2a4\ub97c \uc791\uc131\ud569\ub2c8\ub2e4.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Input schema: ",(0,l.kt)("inlineCode",{parentName:"li"},"Class PredictIn(BaseModel)")," \uc744 \uc774\uc6a9",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Column \uc774\ub984: ",(0,l.kt)(o.L,{mdxType:"Part"},"01. Database")," \ud30c\ud2b8\uc5d0\uc11c \uc791\uc131\ud55c \uc774\ub984\uacfc \ub3d9\uc77c"))),(0,l.kt)("li",{parentName:"ul"},"Output schema: ",(0,l.kt)("inlineCode",{parentName:"li"},"Class PredictOut(BaseModel)")," \uc744 \uc774\uc6a9",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Column \uc774\ub984: ",(0,l.kt)("inlineCode",{parentName:"li"},"iris_class")))))),(0,l.kt)("li",{parentName:"ol"},"\uc791\uc131\ud55c \uba85\uc138\uc11c\ub97c FastAPI \ub97c \uc774\uc6a9\ud574 ",(0,l.kt)("inlineCode",{parentName:"li"},"app.py")," \uc5d0 \uad6c\ud604\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"\uc791\uc131\ud55c API \uc5d0 \ub370\uc774\ud130\ub97c \uc804\ub2ec\ud558\uc5ec \uc798 \uc791\ub3d9\ud558\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4."))),(0,l.kt)(i.Z,{url:"https://github.com/mlops-for-mle/mlops-for-mle/tree/main/part6",mdxType:"BrowserWindow"},(0,l.kt)("p",null,"\ud574\ub2f9 \ud30c\ud2b8\uc758 \uc804\uccb4 \ucf54\ub4dc\ub294 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mlops-for-mle/mlops-for-mle/tree/main/part6"},"mlops-for-mle/part6/")," \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"part6\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 README.md\n// highlight-next-line\n\u251c\u2500\u2500 app.py\n\u251c\u2500\u2500 docker-compose.yaml\n// highlight-next-line\n\u251c\u2500\u2500 download_model.py\n// highlight-next-line\n\u2514\u2500\u2500 schemas.py\n"))),(0,l.kt)("h2",{id:"0-\ud658\uacbd-\uc124\uc815"},"0. \ud658\uacbd \uc124\uc815"),(0,l.kt)("p",null,"\uc774\ubc88 \ud30c\ud2b8\uc5d0\uc11c \uc0ac\uc6a9\ud560 \ud328\ud0a4\uc9c0\ub4e4\uc744 \uc124\uce58\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'# terminal-command\npip install boto3==1.26.8 mlflow==1.30.0 "fastapi[all]" pandas scikit-learn\n')),(0,l.kt)("p",null,"\ub610\ud55c, \uc774\ubc88 \ud30c\ud2b8\uc5d0\uc11c\ub3c4 FastAPI \ub97c \uc0ac\uc6a9\ud558\uc5ec API \uc11c\ubc84\ub97c \uc2e4\ud589\ud560 \uc608\uc815\uc774\ubbc0\ub85c \ud3ec\ud2b8\uac00 \uacb9\uce58\ub294 \ubb38\uc81c\ub97c \ub9c9\uae30 \uc704\ud574 ",(0,l.kt)(o.L,{mdxType:"Part"},"05. FastAPI")," \ud30c\ud2b8\uc5d0\uc11c \ub744\uc6b4 Docker \ucee8\ud14c\uc774\ub108\ub97c \uc885\ub8cc\ud574\uc57c \ud569\ub2c8\ub2e4.\n\ub2e4\uc74c \uba85\ub839\uc5b4\ub97c \ud1b5\ud574 \uc885\ub8cc\uc2dc\ud0b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# terminal-command\ndocker rm --force api-server\n")),(0,l.kt)("h2",{id:"1-\ubaa8\ub378-\ub2e4\uc6b4\ub85c\ub4dc"},"1. \ubaa8\ub378 \ub2e4\uc6b4\ub85c\ub4dc"),(0,l.kt)("h3",{id:"11-base-setting"},"1.1 Base Setting"),(0,l.kt)("p",null,"\uba3c\uc800 \ud544\uc694\ud55c \ud328\ud0a4\uc9c0\ub4e4\uc744 import \ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},"import os\nfrom argparse import ArgumentParser\n\nimport mlflow\n")),(0,l.kt)("h3",{id:"12-environment-variables"},"1.2 Environment Variables"),(0,l.kt)("p",null,"\ub2e4\uc74c\uc73c\ub85c\ub294 Model Registry \uc5d0 \uc800\uc7a5\ub418\uc5b4 \uc788\ub294 \ubaa8\ub378\uc744 \ub2e4\uc6b4\ub85c\ub4dc\ud558\uae30 \uc704\ud574 MLflow \uc11c\ubc84\uc640 MinIO \uc11c\ubc84\uc5d0 \uc811\uc18d\ud558\uae30 \uc704\ud55c \uc815\ubcf4\ub97c \ud658\uacbd \ubcc0\uc218\ub85c \uc124\uc815\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'# Set environments\nos.environ["MLFLOW_S3_ENDPOINT_URL"] = "http://localhost:9000"\nos.environ["MLFLOW_TRACKING_URI"] = "http://localhost:5001"\nos.environ["AWS_ACCESS_KEY_ID"] = "minio"\nos.environ["AWS_SECRET_ACCESS_KEY"] = "miniostorage"\n')),(0,l.kt)("p",null,"\uc774\ub294 ",(0,l.kt)(o.L,{mdxType:"Part"},"03. Model Registry")," \ud30c\ud2b8\uc5d0\uc11c Artifact Store \uc778 MinIO \ub85c\ubd80\ud130 \ubaa8\ub378\uc744 \ubd88\ub7ec\uc62c \ub54c \uc0ac\uc6a9\ud558\ub294 \ud658\uacbd \ubcc0\uc218\uc640 \uac19\uc2b5\ub2c8\ub2e4."),(0,l.kt)("h3",{id:"13-\ubaa8\ub378-\ub2e4\uc6b4\ub85c\ub4dc-\ud568\uc218-\uc791\uc131"},"1.3 \ubaa8\ub378 \ub2e4\uc6b4\ub85c\ub4dc \ud568\uc218 \uc791\uc131"),(0,l.kt)("p",null,"\uc774\uc81c ",(0,l.kt)("inlineCode",{parentName:"p"},"mlflow")," \ud328\ud0a4\uc9c0\ub97c \uc774\uc6a9\ud558\uc5ec model artifact \ub97c \ub2e4\uc6b4\ub85c\ub4dc\ud569\ub2c8\ub2e4."),(0,l.kt)("p",null,"\uc5ec\uae30\uc5d0\uc11c model artifact \ub780, MLFlow \uc5d0 \ubaa8\ub378\uc774 \uc800\uc7a5\ub420 \ub54c \ud568\uaed8 \uc800\uc7a5\ub41c \uba54\ud0c0\ub370\uc774\ud130\uc640 \ubaa8\ub378 \uc790\uccb4\uc758 binary \ud30c\uc77c\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ub2e4\uc74c\uacfc \uac19\uc774 ",(0,l.kt)("inlineCode",{parentName:"p"},"download_model()")," \ud568\uc218\ub97c \uc791\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'def download_model(args):\n    # Download model artifacts\n    mlflow.artifacts.download_artifacts(artifact_uri=f"runs:/{args.run_id}/{args.model_name}", dst_path=".")\n')),(0,l.kt)("p",null,"MLFlow \uc11c\ubc84\uc5d0\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"run_id")," \uc640 ",(0,l.kt)("inlineCode",{parentName:"p"},"model_name")," \uc744 \ud655\uc778\ud558\uc5ec \uc785\ub825\ud574\uc8fc\uba74 \ud574\ub2f9\ud558\ub294 \ubaa8\ub378\uc744 \ucc3e\uc544 \ub2e4\uc6b4\ub85c\ub4dc\ubc1b\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("h3",{id:"14-\ubaa8\ub378-\ub2e4\uc6b4\ub85c\ub4dc"},"1.4 \ubaa8\ub378 \ub2e4\uc6b4\ub85c\ub4dc"),(0,l.kt)("p",null,"\ub2e4\uc74c\uacfc \uac19\uc774 ",(0,l.kt)("inlineCode",{parentName:"p"},"argparse")," \ub97c \uc774\uc6a9\ud558\uc5ec \ud30c\ub77c\ubbf8\ud130\ub97c \uc785\ub825\ubc1b\uc744 \uc218 \uc788\ub3c4\ub85d \ud558\uace0 ",(0,l.kt)("inlineCode",{parentName:"p"},"donwload_model()")," \ud568\uc218\ub97c \ud638\ucd9c\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'if __name__ == "__main__":\n    parser = ArgumentParser()\n    parser.add_argument("--model-name", dest="model_name", type=str, default="sk_model")\n    parser.add_argument("--run-id", dest="run_id", type=str)\n    args = parser.parse_args()\n\n    download_model(args)\n')),(0,l.kt)("h3",{id:"15-download_modelpy"},"1.5 ",(0,l.kt)("inlineCode",{parentName:"h3"},"download_model.py")),(0,l.kt)("p",null,"\uc791\uc131\ud55c \ucf54\ub4dc\ub97c \ubaa8\uc73c\uba74 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="download_model.py"',title:'"download_model.py"'},'import os\nfrom argparse import ArgumentParser\n\nimport mlflow\n\n# Set environments\nos.environ["MLFLOW_S3_ENDPOINT_URL"] = "http://localhost:9000"\nos.environ["MLFLOW_TRACKING_URI"] = "http://localhost:5001"\nos.environ["AWS_ACCESS_KEY_ID"] = "minio"\nos.environ["AWS_SECRET_ACCESS_KEY"] = "miniostorage"\n\n\ndef download_model(args):\n    # Download model artifacts\n    mlflow.artifacts.download_artifacts(artifact_uri=f"runs:/{args.run_id}/{args.model_name}", dst_path=".")\n\n\nif __name__ == "__main__":\n    parser = ArgumentParser()\n    parser.add_argument("--model-name", dest="model_name", type=str, default="sk_model")\n    parser.add_argument("--run-id", dest="run_id", type=str)\n    args = parser.parse_args()\n\n    download_model(args)\n')),(0,l.kt)("h3",{id:"16-\uc2a4\ud06c\ub9bd\ud2b8-\uc2e4\ud589"},"1.6 \uc2a4\ud06c\ub9bd\ud2b8 \uc2e4\ud589"),(0,l.kt)("p",null,"\uba3c\uc800 \ub2e4\uc6b4\ub85c\ub4dc\ubc1b\uace0\uc790 \ud558\ub294 \ubaa8\ub378\uc758 MLFlow \uc11c\ubc84\uc5d0\uc11c \uc800\uc7a5\ub41c ",(0,l.kt)("inlineCode",{parentName:"p"},"run_id")," \uc640 ",(0,l.kt)("inlineCode",{parentName:"p"},"model_name")," \uc744 \uc54c\uc544\uc57c \ud569\ub2c8\ub2e4.",(0,l.kt)("br",{parentName:"p"}),"\n",(0,l.kt)("a",{parentName:"p",href:"http://localhost:5001"},"http://localhost:5001")," \uc5d0 \uc811\uc18d\ud558\uc5ec \ubaa8\ub378\uc774 \uc800\uc7a5\ub41c ",(0,l.kt)("inlineCode",{parentName:"p"},"experiments")," \uc640 ",(0,l.kt)("inlineCode",{parentName:"p"},"run")," \uc744 \uc120\ud0dd\ud558\uc5ec \ud074\ub9ad\ud569\ub2c8\ub2e4.\n","[\uadf8\ub9bc 6-2]","\uc758 \ube68\uac04\uc0c9 \uc0c1\uc790 \ubd80\ubd84\uc5d0\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"run_id")," \uc640 ",(0,l.kt)("inlineCode",{parentName:"p"},"model_name")," \uc744 \uac01\uac01 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("div",{style:{textAlign:"center"}},(0,l.kt)("p",null,(0,l.kt)("img",{alt:"run detail",src:n(3122).Z,width:"3680",height:"2382"}),"\n","[\uadf8\ub9bc 6-2]"," Run Detail")),(0,l.kt)("p",null,"\uc774\uc81c \uc791\uc131\ud55c ",(0,l.kt)("inlineCode",{parentName:"p"},"download_model.py")," \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc2e4\ud589\ud558\uc5ec \ubaa8\ub378\uc744 local \uc5d0 \ub2e4\uc6b4\ub85c\ub4dc\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# terminal-command\npython download_model.py --model-name sk_model --run-id <run-id>\n")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("inlineCode",{parentName:"p"},"<run-id>")," \ubd80\ubd84\uc5d0\ub294 MLFlow \uc11c\ubc84\uc5d0 \uc811\uc18d\ud558\uc5ec \ud655\uc778\ud55c \ubaa8\ub378\uc758 Run ID \ub97c \uc785\ub825\ud574\uc8fc\uba74 \ub429\ub2c8\ub2e4.")),(0,l.kt)("p",null,"\uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc2e4\ud589\ud558\uace0 \ub098\uba74, ",(0,l.kt)("inlineCode",{parentName:"p"},"part6")," directory \uc548\uc5d0 ",(0,l.kt)("inlineCode",{parentName:"p"},"sk_model")," \uc774\ub77c\ub294 directory \uac00 \uc0dd\uc131\ub429\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sk_model\n\u251c\u2500\u2500 MLmodel\n\u251c\u2500\u2500 conda.yaml\n\u251c\u2500\u2500 input_example.json\n\u251c\u2500\u2500 model.pkl\n\u251c\u2500\u2500 python_env.yaml\n\u2514\u2500\u2500 requirements.txt\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"sk_model")," \uc548\uc5d0\ub294 \ub2e4\uc6b4\ub85c\ub4dc\ubc1b\uc740 \ubaa8\ub378\uacfc \uba54\ud0c0\ub370\uc774\ud130 \ub4f1\uc774 \ub4e4\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.\n\ubaa8\ub378\uc774 \ub4e4\uc5b4\uc788\ub294 \uc774 directory \ub97c \uc774\uc6a9\ud574 \uc774\uc81c Model API \ub97c \uc791\uc131\ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4."),(0,l.kt)("h2",{id:"2-model-api-\uba85\uc138\uc11c-\uc791\uc131"},"2. Model API \uba85\uc138\uc11c \uc791\uc131"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"POST /predict")," \ub97c \uc218\ud589\ud588\uc744 \ub54c \ud559\uc2b5\ud55c \ubaa8\ub378\uc758 inference \uacb0\uacfc\ub97c \ubc18\ud658\ud574\uc8fc\ub294 API \uc758 \uba85\uc138\uc11c\ub97c \uc791\uc131\ud569\ub2c8\ub2e4. Request Body \ub85c iris \ub370\uc774\ud130\ub97c \uc804\ub2ec\ud574\uc8fc\uba74 Response Body \ub97c \ud1b5\ud574 \uc608\uce21\ub41c \uac12\uc744 \uc804\ub2ec\ubc1b\uac8c \ub429\ub2c8\ub2e4.  "),(0,l.kt)("p",null,"\uc774\ub97c \ud45c\ub85c \ub098\ud0c0\ub0b4\uba74 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Request Header"),(0,l.kt)("th",{parentName:"tr",align:null},"Request Body"),(0,l.kt)("th",{parentName:"tr",align:null},"Response Body"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"POST /predict"),(0,l.kt)("td",{parentName:"tr",align:null},"{",(0,l.kt)("br",null),"\u2003",'"sepal_length": 6.7,',"\u2003",(0,l.kt)("br",null),"\u2003",'"sepal_width": 3.3,',(0,l.kt)("br",null),"\u2003",'"petal_length": 5.7,',(0,l.kt)("br",null),"\u2003",'"petal_width": 2.1',"\u2003",(0,l.kt)("br",null),"}"),(0,l.kt)("td",{parentName:"tr",align:null},"{",(0,l.kt)("br",null),"\u2003",'"iris_class": 2',"\u2003",(0,l.kt)("br",null),"}")))),(0,l.kt)("h2",{id:"3-pydantic-model-\ub85c-\uc2a4\ud0a4\ub9c8\uc758-\ud074\ub798\uc2a4-\uc791\uc131"},"3. Pydantic Model \ub85c \uc2a4\ud0a4\ub9c8\uc758 \ud074\ub798\uc2a4 \uc791\uc131"),(0,l.kt)("h3",{id:"31-import"},"3.1 Import"),(0,l.kt)("p",null,"\uba3c\uc800, Pydantic Model \uc744 \uc0ac\uc6a9\ud558\uae30 \uc704\ud574 import \ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},"from pydantic import BaseModel\n")),(0,l.kt)("h3",{id:"32-input-schema"},"3.2 Input schema"),(0,l.kt)("p",null,"API \uc5d0\uc11c \uc785\ub825\uc73c\ub85c \ub4e4\uc5b4\uac00\uac8c \ub420 \ub370\uc774\ud130\uc758 \uc2a4\ud0a4\ub9c8\ub97c \ud074\ub798\uc2a4\ub85c \uc791\uc131\ud569\ub2c8\ub2e4. \uc2a4\ud399 \uba85\uc138\uc11c\uc5d0 \ub9de\uac8c ",(0,l.kt)("inlineCode",{parentName:"p"},"Class PredictIn(BaseModel)")," \uc744 \uc791\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},"class PredictIn(BaseModel):\n    sepal_length: float\n    sepal_width: float\n    petal_length: float\n    petal_width: float\n")),(0,l.kt)("p",null,"Iris \ub370\uc774\ud130\uc5d0\uc11c \uac01 column \uc758 \ub370\uc774\ud130 \ud0c0\uc785\uc740 ",(0,l.kt)("inlineCode",{parentName:"p"},"float")," \uc774\ubbc0\ub85c \uc704\uc640 \uac19\uc774 \uc791\uc131\ud574 \uc90d\ub2c8\ub2e4."),(0,l.kt)("h3",{id:"33-output-schema"},"3.3 Output schema"),(0,l.kt)("p",null,"API \uc5d0\uc11c \ubc18\ud658\ud560 \ub370\uc774\ud130\uc758 \uc2a4\ud0a4\ub9c8\ub97c \ud074\ub798\uc2a4\ub85c \uc791\uc131\ud569\ub2c8\ub2e4. \uc2a4\ud399 \uba85\uc138\uc11c\uc5d0 \ub9de\uac8c ",(0,l.kt)("inlineCode",{parentName:"p"},"Class PredictOut(BaseModel)")," \uc744 \uc791\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},"class PredictOut(BaseModel):\n    iris_class: int\n")),(0,l.kt)("p",null,"\ubaa8\ub378\uc774 \ubc18\ud658\ud558\ub294 \uac12\uc740 \uc608\uce21\ub41c \ud074\ub798\uc2a4\ub85c 0, 1, 2 \uc911 \ud558\ub098\uc774\uae30 \ub54c\ubb38\uc5d0 ",(0,l.kt)("inlineCode",{parentName:"p"},"int")," \ud0c0\uc785\uc73c\ub85c \uc791\uc131\ud574 \uc90d\ub2c8\ub2e4."),(0,l.kt)("h3",{id:"34-schemaspy"},"3.4 ",(0,l.kt)("inlineCode",{parentName:"h3"},"schemas.py")),(0,l.kt)("p",null,"\uc791\uc131\ud55c \ucf54\ub4dc\ub97c \ubaa8\uc73c\uba74 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="schemas.py"',title:'"schemas.py"'},"from pydantic import BaseModel\n\nclass PredictIn(BaseModel):\n    sepal_length: float\n    sepal_width: float\n    petal_length: float\n    petal_width: float\n\nclass PredictOut(BaseModel):\n    iris_class: int\n")),(0,l.kt)("h2",{id:"4-predict-api-\uad6c\ud604"},"4. Predict API \uad6c\ud604"),(0,l.kt)("h3",{id:"41-import"},"4.1 Import"),(0,l.kt)("p",null,"\uba3c\uc800, \ud544\uc694\ud55c \ud328\ud0a4\uc9c0\ub4e4\uc744 import \ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},"import mlflow\nimport pandas as pd\nfrom fastapi import FastAPI\nfrom schemas import PredictIn, PredictOut\n")),(0,l.kt)("h3",{id:"42-load-model"},"4.2 Load model"),(0,l.kt)("p",null,"\uc55e\uc11c \ub85c\uceec\uc5d0 \ub2e4\uc6b4\ub85c\ub4dc\ubc1b\uc740 \ubaa8\ub378\uc744 \ubd88\ub7ec\uc624\ub294 \ud568\uc218\ub97c \uc791\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("p",null,"\ub2e4\uc74c\uacfc \uac19\uc774 ",(0,l.kt)("inlineCode",{parentName:"p"},"mlflow")," \ud328\ud0a4\uc9c0\ub97c \uc774\uc6a9\ud558\uc5ec \ubaa8\ub378\uc744 \uc27d\uac8c \ubd88\ub7ec\uc62c \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'def get_model():\n    model = mlflow.sklearn.load_model(model_uri="./sk_model")\n    return model\n\nMODEL = get_model()\n')),(0,l.kt)("h3",{id:"43-create-a-fastapi-instance"},"4.3 Create a FastAPI instance"),(0,l.kt)("p",null,"\uc55e\uc11c ",(0,l.kt)(o.L,{mdxType:"Part"},"05. FastAPI")," \ud30c\ud2b8\uc5d0\uc11c \ud559\uc2b5\ud55c FastAPI \ub97c \uc774\uc6a9\ud574 API \ub97c \uad6c\ud604\ud558\uae30 \uc704\ud574 FastAPI \uc778\uc2a4\ud134\uc2a4\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},"# Create a FastAPI instance\napp = FastAPI()\n")),(0,l.kt)("h3",{id:"44-write-predict-function"},"4.4 Write ",(0,l.kt)("inlineCode",{parentName:"h3"},"predict")," function"),(0,l.kt)("p",null,"API \uc5d0 ",(0,l.kt)("inlineCode",{parentName:"p"},"POST /predict")," \ub97c \uc218\ud589\ud588\uc744 \ub54c \ud559\uc2b5\ud55c \ubaa8\ub378\uc758 inference \uacb0\uacfc\ub97c \ubc18\ud658\ud560 \uc218 \uc788\ub3c4\ub85d ",(0,l.kt)("inlineCode",{parentName:"p"},"predict")," \ud568\uc218\ub97c \uc791\uc131\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'@app.post("/predict", response_model=PredictOut)\ndef predict(data: PredictIn) -> PredictOut:\n    df = pd.DataFrame([data.dict()])\n    pred = MODEL.predict(df).item()\n    return PredictOut(iris_class=pred)\n')),(0,l.kt)("p",null,"\uc694\uccad\ubc1b\uc740 \ub370\uc774\ud130\ub97c \ucc98\ub9ac\ud558\ub294 \uc21c\uc11c\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"predict")," \ud568\uc218\ub294 ",(0,l.kt)("inlineCode",{parentName:"li"},"PredictIn")," \ud074\ub798\uc2a4\uc758 \ub370\uc774\ud130\ub97c \uc785\ub825\uc73c\ub85c \ubc1b\uace0 ",(0,l.kt)("inlineCode",{parentName:"li"},"PredictOut")," \ud074\ub798\uc2a4\ub97c \ubc18\ud658\ud558\ub3c4\ub85d \ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"\uc785\ub825\ubc1b\uc740 \ub370\uc774\ud130\ub97c \ub370\uc774\ud130\ud504\ub808\uc784 \ud615\ud0dc\ub85c \ubcc0\ud658\ud55c \ud6c4, \uc704\uc5d0\uc11c \ubd88\ub7ec\uc628 \ubaa8\ub378\uc744 \uc774\uc6a9\ud558\uc5ec inference \uacb0\uacfc\ub97c \uc800\uc7a5\ud569\ub2c8\ub2e4."),(0,l.kt)("li",{parentName:"ol"},"\ub9c8\uc9c0\ub9c9\uc73c\ub85c \uc800\uc7a5\ub41c \uacb0\uacfc\ub97c ",(0,l.kt)("inlineCode",{parentName:"li"},"PredictOut")," \ud074\ub798\uc2a4\uc5d0 \ub123\uc5b4 \ubc18\ud658\ud569\ub2c8\ub2e4.")),(0,l.kt)("p",null,"POST method \ub97c \uc774\uc6a9\ud558\uc5ec \uc608\uce21\ud560 \uc218 \uc788\ub3c4\ub85d ",(0,l.kt)("inlineCode",{parentName:"p"},"@app.post")," \ub97c \uc774\uc6a9\ud55c \ub370\ucf54\ub808\uc774\ud130\ub85c \ud568\uc218\ub97c \uac10\uc2f8\uc8fc\uace0, ",(0,l.kt)("inlineCode",{parentName:"p"},"response_model")," \uc740 ",(0,l.kt)("inlineCode",{parentName:"p"},"PredictOut")," \ud074\ub798\uc2a4\ub85c \uc9c0\uc815\ud569\ub2c8\ub2e4."),(0,l.kt)("h3",{id:"45-apppy"},"4.5 ",(0,l.kt)("inlineCode",{parentName:"h3"},"app.py")),(0,l.kt)("p",null,"\uc791\uc131\ud55c \ucf54\ub4dc\ub97c \ubaa8\uc73c\uba74 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="app.py"',title:'"app.py"'},'# app.py\nimport mlflow\nimport pandas as pd\nfrom fastapi import FastAPI\nfrom schemas import PredictIn, PredictOut\n\n\ndef get_model():\n    model = mlflow.sklearn.load_model(model_uri="./sk_model")\n    return model\n\n\nMODEL = get_model()\n\n# Create a FastAPI instance\napp = FastAPI()\n\n\n@app.post("/predict", response_model=PredictOut)\ndef predict(data: PredictIn) -> PredictOut:\n    df = pd.DataFrame([data.dict()])\n    pred = MODEL.predict(df).item()\n    return PredictOut(iris_class=pred)\n')),(0,l.kt)("h2",{id:"5-api-\uc791\ub3d9-\ud655\uc778"},"5. API \uc791\ub3d9 \ud655\uc778"),(0,l.kt)("p",null,"\uc774\uc81c \uc791\uc131\ud55c API \uc5d0 \ub370\uc774\ud130\ub97c \uc804\ub2ec\ud558\uc5ec \uc798 \uc791\ub3d9\ud558\ub294\uc9c0 \ud655\uc778\ud574 \ubcf4\uaca0\uc2b5\ub2c8\ub2e4."),(0,l.kt)("p",null,"\uba3c\uc800 \ub2e4\uc74c\uc758 \uba85\ub839\uc5b4\ub97c \uc785\ub825\ud558\uc5ec \uc791\uc131\ud55c API \ub97c \uc2e4\ud589\ud569\ub2c8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# terminal-command\nuvicorn app:app --reload\n")),(0,l.kt)("p",null,"\uc774\uc81c ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8000/docs"},"http://localhost:8000/docs")," (FastAPI - Swagger UI) \uc5d0 \uc811\uc18d\ud558\uc5ec \uc791\ub3d9 \ud14c\uc2a4\ud2b8\ub97c \ud574 \ubd05\uc2dc\ub2e4.",(0,l.kt)("br",{parentName:"p"}),"\n","[\uadf8\ub9bc 6-3]","\uacfc \uac19\uc774 \uc55e\uc11c \uc791\uc131\ud55c predict \ud568\uc218\uac00 \ub098\ud0c0\ub098 \uc788\ub294 \ud654\uba74\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,l.kt)("div",{style:{textAlign:"center"}},(0,l.kt)("p",null,(0,l.kt)("img",{alt:"model api server screen",src:n(7953).Z,width:"3680",height:"2382"}),"\n","[\uadf8\ub9bc 6-3]"," Model API Server Screen")),(0,l.kt)("p",null,"API \ub97c \uc2e4\ud589\ud558\uc5ec \uc55e\uc11c \uc791\uc131\ud55c \uba85\uc138\uc11c\uc5d0 \ub9de\uac8c \uc791\ub3d9\ud558\ub294\uc9c0 \ud14c\uc2a4\ud2b8\ud569\ub2c8\ub2e4."),(0,l.kt)("div",{style:{textAlign:"center"}},(0,l.kt)("p",null,(0,l.kt)("img",{alt:"model api test screen",src:n(2505).Z,width:"3680",height:"2382"}),"\n","[\uadf8\ub9bc 6-4]"," Model API Test Screen")),(0,l.kt)("p",null,"Request Body \uc758 \ud615\ud0dc\uc5d0 \uc54c\ub9de\uac8c \ub370\uc774\ud130\ub97c \uc804\ub2ec\ud574\uc8fc\uba74 ","[\uadf8\ub9bc 6-4]","\uc758 \ube68\uac04\uc0c9 \ubd80\ubd84\uacfc \uac19\uc774 Response Body \ub85c inference \uacb0\uacfc\uac00 \uc798 \ubc18\ud658\ub418\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."))}k.isMDXComponent=!0},3122:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/api-serving-2-8ef5a165ab6500cd7cb66ae693b2e204.png"},7953:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/api-serving-3-ea5e4fa80f73f6556f7848537506c6a8.png"},2505:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/api-serving-4-e3f4e9bfe03d2c1dcf2b0fda62880268.png"}}]);